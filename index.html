<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>QOI</title>
        <style type="text/css">
            /* <![CDATA[ */
            body {
                font-family: sans-serif;
                font-size: 16px;
                color: black;
                background-image: /* tint image */
                      linear-gradient(to right, rgba(200, 200, 200, 0.75), rgba(200, 200, 200, 0.75)),
                      /* checkered effect */
                      linear-gradient(to right, black 50%, white 50%),
                      linear-gradient(to bottom, black 50%, white 50%);
                background-blend-mode: normal, difference, normal;
                background-size: 3rem 3rem;
            }

            .file-button {
                position: relative;
                display: inline-block;
                text-align: center;
                padding: 0.5em 1em;
                overflow: hidden;
                background: #eee;
                cursor: pointer;
                border: 1px solid #555;
                border-radius: 0.5em;
            }

            .file-button:hover {
                background: #bbb;
            }

            .file-button:active {
                background: #999;
            }

            .file-button input {
                visibility: hidden;
                position: absolute;
                left: 0;
                top: 0;
                bottom: 0;
                right: 0;
                width: 100%;
                height: 100%;
            }

            form {
                text-align: center;
            }

            #img {
                display: block;
                margin: 1rem auto;
            }
            /* ]]> */
        </style>
    </head>
    <body>
        <form action="javascript:;" onsubmit="return false;">
            <label class="file-button">Load File...<input type="file" id="file" /></label>
        </form>

        <p>
            <canvas id="img"></canvas>
        </p>

        <script type="module">
            // <![CDATA[
                import * as QOI from "./build/qoi.js";

                async function onImageChange(event) {
                    try {
                        event.preventDefault();
                        event.stopPropagation();

                        const file = event.currentTarget.files[0];

                        // clear input so selecting the same file also triggers onchange:
                        const parent = event.currentTarget.parentNode;
                        event.currentTarget.remove();
                        const newInput = document.createElement("input");
                        newInput.type = "file";
                        newInput.id = "file";
                        newInput.onchange = onImageChange;
                        parent.appendChild(newInput);

                        var qoi = QOI.loadQOI(await file.arrayBuffer());

                        var img = document.getElementById("img");

                        img.width  = qoi.width;
                        img.height = qoi.height;

                        var ctx = img.getContext("2d");
                        ctx.clearRect(0, 0, qoi.width, qoi.height);
                        ctx.putImageData(qoi.imageData, 0, 0);
                    } catch (error) {
                        console.error("error loading image:", error);
                        alert("Error loading image: " + error.message);
                    }
                }

                document.getElementById("file").onchange = onImageChange;
            // ]]>
        </script>
    </body>
</html>
